{% extends "Users/layout.html" %}
{% load crispy_forms_tags %}

{% block body %}

    <h1>Upload Files</h1>
    <form enctype="multipart/form-data" method="POST" action="">
    {% csrf_token %}
    {{ form|crispy }}
    <input type="submit" value="Upload" class="btn btn-primary"/>
    </form>

    <br><br>

 <h1>Already Uploaded Files:</h1>
 <div class="row">
 {% for file in lastfile %}

<div class="col-sm-6">
    <br>
<div class="card">
  <h5 class="card-header"><strong>Name: </strong><a href="{{ MEDIA_URL }}{{ file.filepath }}" target="_blank"> {{ file.name }}</a></h5>
  <div class="card-body">
    <h5 class="card-title"><strong>Description: </strong>{{ file.Description }}</h5>
    <br>
    <form method="POST" action="{% url 'send' file.id %}">
        {% csrf_token %}
        {% for val,text in Send.Doctors.field.choices %}
            <input type="checkbox" class = "{{ file.name }}" name="file_{{file.id}}" value="{{val}}" >
            <label > {{text}} </label>
        {% endfor %}
        <br>
        <input type="submit" value="Send" class="btn btn-primary "/>
    </form>
    <br>
  </div>
</div>
</div>
<br>
{% endfor %}
<br>
</div>

<!--     <h1>Already Uploaded Files:</h1>
 
    {% for file in lastfile %}

    <a href="{{ MEDIA_URL }}{{ file.filepath }}" target="_blank"><strong>{{ file.name }}</strong></a>
    <p>{{ file.Description }}</p>

    <form method="POST" action="{% url 'send' file.id %}">
        {% csrf_token %}
        {% for val,text in Send.Doctors.field.choices %}
            <input type="checkbox" class = "{{ file.name }}" name="file_{{file.id}}" value="{{val}}" >
            <label > {{text}} </label>
        {% endfor %}
        <input type="submit" value="Send" class="btn btn-primary btn-sm"/>
    </form>
    <br>

    {% endfor %}
    <br><br>
    </p>
 -->
    <script>
    document.addEventListener("DOMContentLoaded", function() {
        let id_list = []
        {% for file in lastfile %}
            id_list = []
            {% for doc in file.Doctors.all %} 
                id_list.push("{{ doc.id }}")
            {% endfor%}
                console.log(id_list)
            document.querySelectorAll(".{{file.name}}").forEach(function(check){
                console.log(check.value)
                if(id_list.includes(check.value)){
                    check.checked = true
                }
            })
        {% endfor %}


    })
    </script>

{% endblock %}

